<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAN / NH3 Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to ensure Inter font and smooth transitions */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ensure it takes full viewport height */
            margin: 0;
            padding: 20px; /* Add some padding around the content */
            box-sizing: border-box; /* Include padding in element's total width and height */
        }
        .calculator-container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            padding: 2.5rem; /* Increased padding */
            max-width: 500px; /* Max width for larger screens */
            width: 100%; /* Full width on smaller screens */
            transition: all 0.3s ease-in-out;
            border: 1px solid #e2e8f0; /* Subtle border */
        }
        input[type="number"] {
            border: 1px solid #cbd5e0; /* Light gray border */
            border-radius: 0.5rem; /* Rounded corners for inputs */
            padding: 0.75rem 1rem; /* Generous padding */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input[type="number"]:focus {
            border-color: #6366f1; /* Indigo focus border */
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3); /* Soft focus ring */
        }
        button {
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        button:hover {
            transform: translateY(-1px); /* Slight lift on hover */
        }
        button:active {
            transform: translateY(0); /* Press down effect */
        }
        .error-message {
            color: #ef4444; /* Red for error messages */
            font-size: 0.875rem; /* Small text */
            margin-top: 0.5rem;
        }
        .result-box {
            background-color: #e0f2fe; /* Light blue background for result */
            border: 1px solid #90cdf4; /* Medium blue border */
            border-radius: 0.75rem; /* Rounded corners */
            padding: 1.25rem; /* Ample padding */
            font-size: 1.125rem; /* Larger font size */
            font-weight: 600; /* Semi-bold */
            color: #2563eb; /* Darker blue text */
            text-align: center;
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .calculator-container {
                padding: 1.5rem; /* Smaller padding on small screens */
                border-radius: 1rem;
            }
            .text-3xl {
                font-size: 2rem; /* Adjust title size */
            }
            .text-xl {
                font-size: 1.25rem; /* Adjust result text size */
            }
        }

        /* Specific text colors for NH3 result */
        .text-green-600 { color: #16a34a; } /* Tailwind green-600 */
        .text-orange-600 { color: #ea580c; } /* Tailwind orange-600 */
        .text-red-600 { color: #dc2626; } /* Tailwind red-600 */
    </style>
</head>
<body class="antialiased">
    <div class="calculator-container">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6 text-center">TAN / NH3 Calculator</h1>
        <p class="text-gray-600 mb-8 text-center">Calculate Total Ammonia Nitrogen from NH4+, pH, and temperature.</p>

        <div class="space-y-6">
            <div>
                <label for="nh4Plus" class="block text-sm font-medium text-gray-700 mb-2">NH4+ Concentration (mg/L):</label>
                <input type="number" id="nh4Plus" placeholder="e.g., 0.5" class="w-full shadow-sm" step="0.01">
                <p id="nh4PlusError" class="error-message hidden"></p>
            </div>

            <div>
                <label for="ph" class="block text-sm font-medium text-gray-700 mb-2">pH:</label>
                <input type="number" id="ph" placeholder="e.g., 7.5" class="w-full shadow-sm" step="0.01">
                <p id="phError" class="error-message hidden"></p>
            </div>

            <div>
                <label for="temperature" class="block text-sm font-medium text-gray-700 mb-2">Temperature (°C):</label>
                <input type="number" id="temperature" placeholder="e.g., 25" class="w-full shadow-sm" step="0.1">
                <p id="temperatureError" class="error-message hidden"></p>
            </div>

            <button id="calculateBtn"
                    class="w-full py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75">
                Calculate
            </button>
        </div>

        <div id="resultContainer" class="result-box mt-8 hidden">
            <p class="mb-2">Total Ammonia Nitrogen (TAN): <span id="tanResult" class="font-bold"></span> mg/L</p>
            <p>Unionized Ammonia (NH3): <span id="nh3Result" class="font-bold"></span> mg/L</p>
        </div>

        <div id="errorMessageContainer" class="result-box bg-red-100 border-red-400 text-red-700 mt-8 hidden">
            <p><span id="generalErrorMessage" class="font-bold"></span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nh4PlusInput = document.getElementById('nh4Plus');
            const phInput = document.getElementById('ph');
            const temperatureInput = document.getElementById('temperature');
            const calculateBtn = document.getElementById('calculateBtn');
            const tanResultSpan = document.getElementById('tanResult');
            const nh3ResultSpan = document.getElementById('nh3Result');
            const resultContainer = document.getElementById('resultContainer');
            const errorMessageContainer = document.getElementById('errorMessageContainer');
            const generalErrorMessageSpan = document.getElementById('generalErrorMessage');

            // Error message elements for individual inputs
            const nh4PlusError = document.getElementById('nh4PlusError');
            const phError = document.getElementById('phError');
            const temperatureError = document.getElementById('temperatureError');

            /**
             * Hides all individual error messages.
             */
            const hideAllInputErrors = () => {
                nh4PlusError.classList.add('hidden');
                phError.classList.add('hidden');
                temperatureError.classList.add('hidden');
            };

            /**
             * Displays a general error message and hides results.
             * @param {string} message - The error message to display.
             */
            const showGeneralError = (message) => {
                resultContainer.classList.add('hidden');
                errorMessageContainer.classList.remove('hidden');
                generalErrorMessageSpan.textContent = message;
            };

            /**
             * Hides the general error message.
             */
            const hideGeneralError = () => {
                errorMessageContainer.classList.add('hidden');
            };

            /**
             * Resets the color classes on the NH3 result span.
             */
            const resetNh3Color = () => {
                nh3ResultSpan.classList.remove('text-green-600', 'text-orange-600', 'text-red-600');
            };


            calculateBtn.addEventListener('click', () => {
                hideAllInputErrors(); // Clear previous input errors
                hideGeneralError();   // Clear previous general errors
                resultContainer.classList.add('hidden'); // Hide result container initially
                resetNh3Color(); // Reset NH3 color before new calculation

                const nh4Plus = parseFloat(nh4PlusInput.value);
                const ph = parseFloat(phInput.value);
                const temperature = parseFloat(temperatureInput.value);

                let isValid = true;

                // Input validation
                if (isNaN(nh4Plus) || nh4Plus < 0) {
                    nh4PlusError.textContent = 'Please enter a valid non-negative number for NH4+.';
                    nh4PlusError.classList.remove('hidden');
                    isValid = false;
                }
                if (isNaN(ph) || ph < 0 || ph > 14) {
                    phError.textContent = 'Please enter a valid pH value between 0 and 14.';
                    phError.classList.remove('hidden');
                    isValid = false;
                }
                if (isNaN(temperature) || temperature < -273.15) { // Absolute zero
                    temperatureError.textContent = 'Please enter a valid temperature (°C).';
                    temperatureError.classList.remove('hidden');
                    isValid = false;
                }

                if (!isValid) {
                    showGeneralError('Please correct the input errors.');
                    return;
                }

                try {
                    // Convert temperature to Kelvin
                    const tempKelvin = temperature + 273.15;

                    // Calculate pKa (temperature-dependent dissociation constant)
                    // This formula is a common approximation for ammonia.
                    // Source: Emerson, L., et al. "Aqueous ammonia equilibrium calculations: effect of pH and temperature."
                    // Journal of the Fisheries Research Board of Canada 32.12 (1975): 2379-2383.
                    const pKa = 0.09018 + (2729.92 / tempKelvin);

                    // Calculate the fraction of unionized ammonia (fNH3)
                    // fNH3 = 1 / (1 + 10^(pKa - pH))
                    const fNH3 = 1 / (1 + Math.pow(10, (pKa - ph)));

                    // Calculate TAN from NH4+ using the fraction of unionized ammonia
                    // TAN = NH4+ / (1 - fNH3)
                    // If fNH3 is too close to 1, (1 - fNH3) can be close to 0, leading to division by zero or very large numbers.
                    // This typically happens at very high pH and temperature where almost all ammonia is unionized.
                    if ((1 - fNH3) === 0 || (1 - fNH3) < 1e-9) { // Check for near-zero denominator
                        showGeneralError('Cannot calculate TAN. At this pH and temperature, NH4+ concentration is negligible compared to TAN, or the parameters are outside typical ranges for this calculation.');
                        return;
                    }

                    const tan = nh4Plus / (1 - fNH3);
                    const nh3 = tan * fNH3; // Calculate NH3 from TAN and the fraction of unionized ammonia

                    // Display the results
                    tanResultSpan.textContent = tan.toFixed(3); // Format to 3 decimal places
                    nh3ResultSpan.textContent = nh3.toFixed(3); // Format NH3 to 3 decimal places

                    // Apply color based on NH3 value
                    if (nh3 >= 0.0 && nh3 <= 0.018) {
                        nh3ResultSpan.classList.add('text-green-600');
                    } else if (nh3 >= 0.0185 && nh3 <= 0.0195) {
                        nh3ResultSpan.classList.add('text-orange-600');
                    } else if (nh3 >= 0.0196) {
                        nh3ResultSpan.classList.add('text-red-600');
                    }
                    // Note: Values outside these ranges (e.g., negative, or between 0.018 and 0.0185, or between 0.0195 and 0.0196)
                    // will default to the standard text color as no specific class is applied.

                    resultContainer.classList.remove('hidden');
                    hideGeneralError(); // Hide any previous general error if calculation is successful

                } catch (error) {
                    console.error("Error during calculation:", error);
                    showGeneralError('An unexpected error occurred during calculation. Please check your inputs.');
                }
            });
        });
    </script>
</body>
</html>

